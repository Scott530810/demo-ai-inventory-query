# 救護車庫存查詢系統 - 使用說明

## ✅ 系統已修復並正常運作

### 已修復的問題:
1. ✅ 創建了缺失的 `Dockerfile.ollama`
2. ✅ 創建了 `requirements.txt` (Python 依賴)
3. ✅ 創建了 `ambulance_inventory_demo.sql` (包含 40 項商品數據)
4. ✅ 修復了 Docker Compose 版本警告
5. ✅ 修復了 Decimal 類型 JSON 序列化錯誤
6. ✅ 修復了 Demo 模式的互動式輸入問題

---

## 🚀 快速開始

### 方法一: 使用 PowerShell 腳本 (推薦)

```powershell
cd "C:\Users\scott\Desktop\files (1)"
.\run-ollama-fixed.ps1
```

選擇選項:
- **1** - 啟動系統 (首次使用請選這個)
- **2** - 系統檢查 (確認所有組件正常)
- **3** - 執行 Demo 查詢 (體驗 5 個預設查詢)
- **4** - 互動模式 (自由提問)
- **5** - 啟動 pgAdmin (資料庫管理介面)
- **6** - 查看日誌
- **7** - 停止系統
- **8** - 清除所有數據

---

### 方法二: 使用 Docker Compose 直接執行

#### 啟動系統:
```powershell
docker-compose -f docker-compose.ollama.yml up -d
```

#### 系統檢查:
```powershell
docker-compose -f docker-compose.ollama.yml run --rm query-app-ollama python test_llm_query_ollama.py --check
```

#### 執行 Demo:
```powershell
docker-compose -f docker-compose.ollama.yml run --rm query-app-ollama python test_llm_query_ollama.py --demo
```

#### 互動模式:
```powershell
docker-compose -f docker-compose.ollama.yml run --rm query-app-ollama python test_llm_query_ollama.py --interactive
```

#### 停止系統:
```powershell
docker-compose -f docker-compose.ollama.yml down
```

---

## 📊 系統狀態

當前配置:
- **資料庫**: PostgreSQL 15
- **商品數量**: 40 項
- **商品分類**: 11 個分類
  - AED除顫器
  - 擔架設備
  - 氧氣設備
  - 監視器
  - 抽吸設備
  - 呼吸設備
  - 固定器材
  - 急救包
  - 車內設備
  - 防護用品
  - 通訊設備

- **LLM 模型**: qwen3:30b (本地 Ollama)
- **資料庫端口**: 5432
- **pgAdmin 端口**: 5050

---

## 💡 範例查詢

### 簡單查詢:
- "請問 AED 除顫器還有哪幾款有庫存?"
- "我們公司還有多少擔架?"
- "Philips 的產品有哪些?"
- "哪些商品庫存不足 10 件?"

### 複雜查詢 (展現 LLM 威力):
- "我需要配備新救護車,預算 30 萬,請推薦設備清單"
- "預算 5 萬以內有什麼監視器可以買?"
- "比較 Philips 和 ZOLL 的 AED 優缺點"
- "為新手推薦一套基本急救設備"
- "Philips 飛利浦的產品有哪些?總價值多少?"

---

## 🔧 故障排除

### 問題: "Docker is not running"
**解決**: 啟動 Docker Desktop

### 問題: "Ollama is not running or cannot connect"
**解決**:
1. 確認 Ollama 正在運行 (檢查系統托盤)
2. 設定環境變數 (PowerShell 管理員模式):
   ```powershell
   [Environment]::SetEnvironmentVariable("OLLAMA_HOST", "0.0.0.0", "User")
   ```
3. 重啟 Ollama

### 問題: "Model qwen3:30b not found"
**解決**:
```powershell
ollama pull qwen3:30b
```

### 問題: "relation inventory does not exist"
**解決**: 重新初始化資料庫
```powershell
docker-compose -f docker-compose.ollama.yml down -v
docker-compose -f docker-compose.ollama.yml up -d
```

---

## 📁 文件說明

- `docker-compose.ollama.yml` - Docker 服務配置
- `Dockerfile.ollama` - Python 應用容器配置
- `requirements.txt` - Python 依賴套件
- `test_llm_query_ollama.py` - 主程式
- `ambulance_inventory_demo.sql` - 資料庫初始化腳本
- `run-ollama-fixed.ps1` - PowerShell 啟動腳本
- `QUICKSTART_OLLAMA.md` - 快速開始指南
- `README_OLLAMA.md` - 詳細說明文檔

---

## ✨ 測試結果範例

查詢: "請問 AED 除顫器還有哪幾款有庫存?"

AI 回應:
```
您好！以下是目前有庫存的AED除顫器款式，已整理關鍵資訊供您參考：

- Philips HeartStart HS1：15台，45,000元
- Mindray BeneHeart C2：12台，38,000元（性價比最高，價格最優惠）
- ZOLL AED Plus：8台，52,000元
- Cardiac Science Powerheart G5：5台，58,000元（庫存最低，建議優先補貨）

補充建議：
- 低庫存警示：Powerheart G5僅剩5台，建議盡快確認需求或補貨，避免影響緊急使用。
- 價格比較：Mindray C2（38,000元）為最經濟選擇，適合預算有限的單位；
  若需高階功能（如ZOLL的智能分析），可考慮AED Plus。
```

---

## 🎯 享受使用!

完全免費、隱私安全的本地端 AI 查詢系統! 🚀
